# –î–µ–ø–ª–æ–π

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞[(–≤–≤–µ—Ä—Ö)](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md)

1. –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–∞—Ä–∏–π —á–µ—Ä–µ–∑ git clone

<aside>
üìé [https://backend-git.absc.local/backend/eft-backend-deploy](https://backend-git.absc.local/backend/eft-backend-deploy)

</aside>

2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞:

```php
 sudo apt-get update && sudo apt-get install ruby rubygems
sudo gem install capistrano capistrano-composer
sudo gem install capistrano-git-copy #–∫–æ—Å—Ç—ã–ª—å –¥–ª—è –ø—Ä–æ–¥–∞
```

–ø–æ –¥–æ–∫–µ –∏–∑ –∫–æ–Ω—Ñ–ª

```php
sudo apt-get update && sudo apt-get install ruby rubygems
sudo gem install capistrano capistrano-composer capistrano-git-copy dotenv bcrypt_pbkdf
sudo gem install ed25519 -v 1.2.4
```

–û—Ç–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ nano ~/.bashrc

```php
nano ~/.bashrc
```

–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü ~/.bashrc:

```php
# ssh-agent configuration
    if [ -z "$(pgrep ssh-agent)" ]; then
        rm -rf /tmp/ssh-*
        eval $(ssh-agent -s) > /dev/null
    else
        export SSH_AGENT_PID=$(pgrep ssh-agent)
        export SSH_AUTH_SOCK=$(find /tmp/ssh-* -name agent.*)
    fi
    
    if [ "$(ssh-add -l)" == "The agent has no identities." ]; then
        ssh-add
    fi
```

–î–æ–±–∞–≤–∏—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç /etc/ssh/ssh_config —á–µ—Ä–µ–∑ nano

```php
nano /etc/ssh/ssh_config
```

—Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ—á–∫—É –≤ –∫–æ–Ω–µ—Ü

```php
ForwardAgent yes
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å bash

```php
 exec $SHELL
```

## –î–µ–ø–ª–æ–π:[(–≤–≤–µ—Ä—Ö)](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md)

–ó–∞–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞

![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled.png)

–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π

```php
cap ENV deploy branch=BRANCH
```

- `ENV` - –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`prod`, `dev-01`, `stage-01`, etc...),
- `BRANCH` - –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ (`dev`, `feature/EFT-14415`, etc...).

–ü—Ä–∏–º–µ—Ä

<aside>
üìé cap partners deploy branch=hotfix/0.12.8.2

</aside>

partners - –Ω–∞–∑–≤–∞–Ω–∏–µ  –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏–ª–∏ –¥–µ–≤–∞(—Å–ø–∏—Å–æ–∫ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [–∑–¥–µ—Å—å](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md))

![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%201.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%201.png)

hotfix/0.12.8.2 –∏–º—è –≤–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—É—é –Ω–∞–¥–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ö–æ—Å—Ç–∞–º–∏[(–≤–≤–µ—Ä—Ö)](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md)

```php
cap dev-01 migration:migrate scheme=taxonomy stage_to=dev-04
```

–ì–¥–µ `dev-01` - –æ—Ç–∫—É–¥–∞, `dev-04` - –∫—É–¥–∞, `taxonomy` - –°—Ö–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–º. `ModuleHasMigrationSchemeInterface`)

–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ ssh-–∫–ª—é—á–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ deploy/vagrant.rb –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ ssh-agent (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ ssh-agent:
[http://killtheradio.net/how-tos/ssh-agent-on-cygwin/](http://killtheradio.net/how-tos/ssh-agent-on-cygwin/)

–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
[https://github.com/capistrano/capistrano](https://github.com/capistrano/capistrano)

## –°–º–æ—Ç—Ä–µ—Ç—å –≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ –∫–∞–ø–∏—Å—Ç—Ä–∞–Ω—É[(–≤–≤–µ—Ä—Ö)](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md)

- –∑–∞—Ö–æ–¥–∏–º –≤ eft-backend-deploy –∏ –≤–≤–æ–¥–∏–º
    
    ```php
    cap <–∏–º—è –±–µ–∫–∞> deploy:branch
    ```
    
    –Ω–∞–ø—Ä–∏–º–µ—Ä
    
    ```php
    cap dev-01 deploy:branch
    ```
    
    –ë—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ  –∑–∞–ª–∏–≤–∫–∏ –∫–æ–≥–¥–∞ –±—ã–ª–∏ –∏ –∫–∞–∫–∏—Ö –≤–µ—Ç–æ–∫
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%202.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%202.png)
    

## –ò–∑–º–µ–Ω—è—Ç—å parameters.yml –Ω–∞ –≤—Å–µ—Ö –≤–µ–±–∞—Ö ETS —á–µ—Ä–µ–∑ –ö–∞–ø–∏—Å—Ç—Ä–∞–Ω—É[(–≤–≤–µ—Ä—Ö)](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md)

- –∑–∞—Ö–æ–¥–∏–º –≤ eft-backend-deploy –∏ –≤–≤–æ–¥–∏–º
    
    ```php
    git pull origin master
    ```
    
    —á—Ç–æ–±—ã –º–∞—Å—Ç–µ—Ä –¥–µ–ø–ª–æ–µ—Ä–∞ –±—ã–ª –∞–∫—Ç—É–∞–ª—å–Ω—ã–º
    
- –∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –ø–∞—Ä–∞–º–µ—Ç–µ—Ä—Å —è–º–ª —Å–µ–±–µ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
    
    ```php
    cap ets deploy:download
    ```
    
    —Å–∫–∞—á–∞—é—Ç—Å—è –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%203.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%203.png)
    
- –≠—Ç–∏ —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ eft-backend-deploy/shared
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%204.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%204.png)
    
- –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª parameters.yml –Ω–∞—Ö–æ–¥—è—Å—å –≤ eft-backend-deploy/ –≤–≤–æ–¥–∏–º
    
    ```php
    vi shared/app/config/parameters.yml
    ```
    
- –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ vim parameters.yml
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%205.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%205.png)
    
- –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –¥–µ–ø–ª–æ–µ–º
    
    ```php
    vi config/deploy.rb
    ```
    
    –ò—â–µ–º –∫–æ–º–∞–Ω–¥—É upload
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%206.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%206.png)
    
    –†–∞—Å–∫–æ–º–º–µ–Ω—á–∏–≤–∞–µ–º parameters.yml —á—Ç–æ–±—ã –ª–æ–∫–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∞–π–ª
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%207.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%207.png)
    
- –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞ –≤—Å–µ –≤–µ–±—ã
    
    –≤–≤–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É
    
    ```php
    cap ets deploy:upload
    ```
    
    –ü–∞—Ä–∞–º–µ—Ç–µ—Ä—Å —è–º–ª –≤–µ–∑–¥–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –Ω–∞ –≤—Å–µ –≤–µ–±–∫–∏
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%208.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%208.png)
    
- –ü–æ—á–∏—Å—Ç–∏—Ç—å –ö—ç—à –°–∏–º—Ñ–æ–Ω–∏ –Ω–∞ –≤—Å–µ—Ö –≤–µ–±–∫–∞—Ö
    
    ```php
    cap ets deploy:cache_clear
    ```
    
    –±—É–¥–µ—Ç —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%209.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%209.png)
    
- –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –ø–æ–º–µ–Ω—è–ª–∏ –≤ –¥–µ–ø–ª–æ–µ—Ä–µ
    
    ```php
    git status
    ```
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%2010.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%2010.png)
    
- –¢–æ, —á—Ç–æ –º—ã –ø–æ–º–µ–Ω—è–ª–∏, –Ω–∞–¥–æ –≤–µ—Ä–Ω—É—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
    
    –æ–±—Ä–∞—Ç–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∏–º —Å—Ç—Ä–æ—á–∫—É
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%2011.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%2011.png)
    
- –ï—â–µ —Ä–∞–∑ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å
    
    ```php
    git status
    ```
    
    ![%D0%94%D0%B5%D0%BF%D0%BB%D0%BE%D0%B8%CC%86%203caf631031da4278934ec9abb4e676bc/Untitled%2012.png](–†–∞–±–æ—Ç–∞/Backend/–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc/Untitled%2012.png)
    

## –î–æ–±–∞–≤–∏—Ç—å –∞–π–ø–∏—à–Ω–∏–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–ª–¥–∞–º[(–≤–≤–µ—Ä—Ö)](–î–µ–ø–ª–æ–π%203caf631031da4278934ec9abb4e676bc.md)

1. –í –ø—Ä–æ–µ–∫—Ç–µ –¥–µ–ø–ª–æ—è cap prod deploy:download
2. –î–æ–±–∞–≤–ª—è–µ—à—å –≤ —Ä–∞–∑–¥–µ–ª–µ ip_whitelist –Ω—É–∂–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
3. –†–∞—Å–∫–æ–º–µ–Ω—á–∏–≤–∞–µ—à—å —Å—Ç—Ä–æ–∫—É upload!('shared/app/config/parameters.yml', "#{shared_path}/app/config/parameters.yml") –≤ deploy.rb
4. –ó–∞–≥—Ä—É–∂–∞–µ—à—å –∫–æ–Ω—Ñ–∏–≥ -
cap prod deploy:upload
5. –ü–æ ssh –∑–∞–π—Ç–∏ –Ω–∞ –ª–∞—É–Ω—á–µ—Ä–Ω—ã–µ –≤–µ–±–∫–∏: app-36.eft.local –∏ app-37.eft.local –∏ –ø–æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —Å–∏–º—Ñ–æ–Ω–∏ cd /www_store/prod.escapefromtarkov.com/current/ && bin/console c:clear

## –ö–∞–∫ —É–±—Ä–∞—Ç—å –∞–π–ø–∏—à–Ω–∏–∫ –∏–∑ –≤–∞–π—Ç–ª–∏—Å—Ç–∞

1. cap prod deploy:download
2. –í —Ä–µ–ø–∫–µ –¥–µ–ø–ª–æ—è —É–¥–∞–ª–∏—Ç—å –∏–∑ shared/app/config/parameters.yml ip –∏–∑ —Å–ø–∏—Å–∫–∞ ip_whitelist
3. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ç—å parameters.yml –≤ deploy:upload –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å cap prod deploy:upload
4. –ü–æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –Ω–∞ –ª–∞—É–Ω—á–µ—Ä–Ω—ã—Ö –≤–µ–±–∫–∞—Ö

## –û—à–∏–±–∫–∞ Gem::MissingSpecError : "Could not find 'ed25519' (~> 1.2) among 66 total gem(s)

–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –¥–µ–ø–ª–æ–µ—Ä–∞

```php
eval $(ssh-agent -s)
ssh-add ~/.ssh/id_rsa
```

## –û—à–∏–±–∫–∞ –Ω–∞ —Ä–∞–∑–æ–≥—Ä–µ–≤–µ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

–ü–∞–¥–∞–µ—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

```sql
set :deploy_to, '/www_store'set :context, 'eft'set :isDev, 'true'server "dev-19.dev-eft.local", roles: [:app, :primary, :cron, :consumer],       :user => "content",       :ssh_options => {           user: "content",           forward_agent: true,           auth_methods: %w(publickey)       }
```

–ü–æ–º–µ–Ω—è—Ç—å –≤ –∑–∞–¥–∞—á–µ –Ω–∞ –±–µ–∫

```sql
set :deploy_to, '/www_store'
set :context, 'eft'
**set :isDev, 'true'**

server "dev-19.dev-eft.local", roles: [:app, :primary, :cron, :consumer],
       :user => "content",
       :ssh_options => {
           user: "content",
           forward_agent: true,
           auth_methods: %w(publickey)
       }
```